worker_processes 1;

pid  /run/nginx.pid;

error_log  /var/log/nginx/nginx_error.log  warn;

#error_log  /dev/stdout  info;

events { worker_connections 1024; }

#==================================================================
#==================================================================
#==================== BEGIN HTTP ==================================
http {

  include /etc/nginx/sites-enabled/*.conf;
  server_names_hash_bucket_size 64;


  upstream neocompiler {
    server 172.17.0.1:8000;
    server neocompiler-eco.neoresearch.io backup;
    #server neoresearch.io/neocompiler-eco;
  }

  upstream neoscan {
    server 172.17.0.1:4000;
  }

  server {
   listen         80;
     return 301 https://$host$request_uri;
  }

#  upstream node1 {
#    server http://172.19.0.3:30333;
#  }
#  upstream node2 {
#    server http://172.19.0.3:30334;
#  }
#  upstream node3 {
#    server http://172.19.0.3:30335;
#  }
#  upstream node4 {
#    server http://172.19.0.3:30336;
#  }

#neocompiler.io
#  server {
#    listen 30333 ssl http2;
#    server_name neocompiler.io;
#    proxy_pass http://172.19.0.3:30333;
#  }

  #==================================================================
  #==================================================================
  #==================== STARTING SSL CERTIFICATES ===================

  #==================================================================
  #======================= MAIN ECO SERVER ==========================
  server {
   listen 443 ssl http2;
   listen [::]:443 ssl http2;

   # add Strict-Transport-Security to prevent man in the middle attacks
  add_header Strict-Transport-Security "max-age=31536000" always;

   server_name eco.neocompiler.io;
    ssl on;
    ssl_certificate /etc/letsencrypt/live/neocompiler.io-0002/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/neocompiler.io-0002/privkey.pem;

    return 301 https://neocompiler.io$request_uri;  
  }
  #======================= MAIN ECO SERVER ==========================
  #==================================================================

  #==================================================================
  #======================= MAIN ECO SERVER II =======================
   server {
   listen 443 ssl http2;
   listen [::]:443 ssl http2;

   # add Strict-Transport-Security to prevent man in the middle attacks
   add_header Strict-Transport-Security "max-age=31536000" always;

   server_name neocompiler.io;
    ssl on;
    ssl_certificate /etc/letsencrypt/live/neocompiler.io-0002/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/neocompiler.io-0002/privkey.pem;

   if ($scheme != "https") {
        return 301 https://$host$request_uri;
   }
   location / {
    proxy_set_header  X-Real-IP  $remote_addr;
    proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Host $http_host;
    proxy_set_header X-Forwarded-Proto https;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_redirect off;
    proxy_pass http://neocompiler;
   }  
  } #neocompiler.io
  #======================= MAIN ECO SERVER II =======================
  #==================================================================

  #==================================================================
  #======================= NEOSCAN ==================================
  server {
   listen 443 ssl http2 ;
   listen [::]:443 ssl http2;
   server_name neoscan.neocompiler.io;

    ssl on;
    ssl_certificate /etc/letsencrypt/live/neocompiler.io-0002/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/neocompiler.io-0002/privkey.pem;

    if ($scheme != "https") {
        return 301 https://$host$request_uri;
    }
   location / {
    proxy_set_header  X-Real-IP  $remote_addr;
    proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Host $http_host;
    proxy_set_header X-Forwarded-Proto https;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_redirect off;
    proxy_pass http://neoscan;
   }
  } #neoscan
  #======================= NEOSCAN ==================================
  #==================================================================

  #==================================================================
  #=========================== REST =================================
  server {
   listen 443 ssl http2;
   listen [::]:443 ssl http2;

   server_name rest.neocompiler.io;
    ssl on;
    ssl_certificate /etc/letsencrypt/live/neocompiler.io-0002/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/neocompiler.io-0002/privkey.pem;
   if ($scheme != "https") {
        return 301 https://$host$request_uri;
   }

   location / {
    proxy_set_header  X-Real-IP  $remote_addr;
    proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Host $http_host;
    proxy_set_header X-Forwarded-Proto https;
    proxy_redirect off;
    proxy_pass http://neocompiler.io:8080/;
   }
  }
  #=========================== REST =================================
  #==================================================================

  #==================================================================
  #=========================== COMPILERS ============================
  server {
   listen 443 ssl http2;
   listen [::]:443 ssl http2;

   server_name compilers.neocompiler.io;
    ssl on;
    ssl_certificate /etc/letsencrypt/live/neocompiler.io-0002/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/neocompiler.io-0002/privkey.pem;
   if ($scheme != "https") {
        return 301 https://$host$request_uri;
   }

   location / {
    proxy_set_header  X-Real-IP  $remote_addr;
    proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Host $http_host;
    proxy_set_header X-Forwarded-Proto https;
    proxy_redirect off;
    proxy_pass http://neocompiler.io:10000/;
   }
  }
  #=========================== COMPILERS ============================
  #==================================================================

  #==================================================================
  #=========================== COMPILERS2 ===========================
  server {
   listen 443 ssl http2;
   listen [::]:443 ssl http2;

   server_name compilers2.neocompiler.io;
    ssl on;
    ssl_certificate /etc/letsencrypt/live/neocompiler.io-0002/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/neocompiler.io-0002/privkey.pem;
   if ($scheme != "https") {
        return 301 https://$host$request_uri;
   }

   location / {
    proxy_set_header  X-Real-IP  $remote_addr;
    proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Host $http_host;
    proxy_set_header X-Forwarded-Proto https;
    proxy_redirect off;
    proxy_pass 178.128.203.47:10000/;
   }
 } 
  #=========================== COMPILERS2 ===========================
  #==================================================================

  #==================================================================
  #======================= ECOSERVICES ==============================
  server {
   listen 443 ssl http2;
   listen [::]:443 ssl http2;

   server_name ecoservices.neocompiler.io;
    ssl on;
    ssl_certificate /etc/letsencrypt/live/neocompiler.io-0002/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/neocompiler.io-0002/privkey.pem;
   if ($scheme != "https") {
        return 301 https://$host$request_uri;
   }

   location / {
    proxy_set_header  X-Real-IP  $remote_addr;
    proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Host $http_host;
    proxy_set_header X-Forwarded-Proto https;
    proxy_redirect off;
    proxy_pass http://neocompiler.io:9000/;
   }
  }
  #======================= ECOSERVICES ==============================
  #==================================================================

  #==================================================================
  #======================= NODE1 ====================================
  server {
   listen 443 ssl http2;
   listen [::]:443 ssl http2;

   add_header Strict-Transport-Security "max-age=31536000" always;

   server_name node1.neocompiler.io;
    ssl on;
    ssl_certificate /etc/letsencrypt/live/neocompiler.io-0002/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/neocompiler.io-0002/privkey.pem;

   if ($scheme != "https") {
        return 301 https://$host$request_uri;
   }

   location / {
    proxy_set_header  X-Real-IP  $remote_addr;
    proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Host $http_host;
    proxy_set_header X-Forwarded-Proto https;
    proxy_redirect off;
    proxy_pass http://neocompiler.io:30333/;
   }
  }
  #======================= NODE1 ====================================
  #==================================================================

  #==================================================================
  #======================= NODE2 ====================================
  server {
   listen 443 ssl http2;
   listen [::]:443 ssl http2;

   add_header Strict-Transport-Security "max-age=31536000" always;

   server_name node2.neocompiler.io;
    ssl on;
    ssl_certificate /etc/letsencrypt/live/neocompiler.io-0002/fullchain.pem;
   ssl_certificate_key /etc/letsencrypt/live/neocompiler.io-0002/privkey.pem;

   if ($scheme != "https") {
        return 301 https://$host$request_uri;
   }

   location / {
    proxy_set_header  X-Real-IP  $remote_addr;
    proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Host $http_host;
    proxy_set_header X-Forwarded-Proto https;
    proxy_redirect off;
    proxy_pass http://neocompiler.io:30337/;
   }
  }
  #======================= NODE2 ====================================
  #==================================================================

  #==================================================================
  #======================= NODE3 ====================================
  server {
   listen 443 ssl http2;
   listen [::]:443 ssl http2;

   add_header Strict-Transport-Security "max-age=31536000" always;

   server_name node3.neocompiler.io;
    ssl on;
    ssl_certificate /etc/letsencrypt/live/neocompiler.io-0002/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/neocompiler.io-0002/privkey.pem;

   if ($scheme != "https") {
        return 301 https://$host$request_uri;
   }

   location / {
    proxy_set_header  X-Real-IP  $remote_addr;
    proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Host $http_host;
    proxy_set_header X-Forwarded-Proto https;
   proxy_redirect off;
    proxy_pass http://neocompiler.io:30338/;
   }
  }
  #======================= NODE3 ====================================
  #==================================================================

  #==================================================================
  #======================= NODE4 ====================================
  server {
   listen 443 ssl http2;
   listen [::]:443 ssl http2;

   add_header Strict-Transport-Security "max-age=31536000" always;

   server_name node4.neocompiler.io;
    ssl on;
    ssl_certificate /etc/letsencrypt/live/neocompiler.io-0002/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/neocompiler.io-0002/privkey.pem;

   if ($scheme != "https") {
        return 301 https://$host$request_uri;
   }

   location / {
    proxy_set_header  X-Real-IP  $remote_addr;
    proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Host $http_host;
    proxy_set_header X-Forwarded-Proto https;
    proxy_redirect off;
    proxy_pass http://neocompiler.io:9000/;
   }
  } 
  #======================= NODE4 ====================================
  #==================================================================

  #==================== STARTING SSL CERTIFICATES ===================
  #==================================================================
  #==================================================================

#  server {
#   listen 443 ssl http2;
#   listen [::]:443 ssl http2;
#
#   server_name eco.neocompiler.io;
#    ssl on;
#    ssl_certificate /etc/letsencrypt/live/neocompiler.io-0002/fullchain.pem;
#    ssl_certificate_key /etc/letsencrypt/live/neocompiler.io-0002/privkey.pem;

#   if ($scheme != "https") {
#        return 301 https://$host$request_uri;
#   }

#   location / {
#    proxy_set_header  X-Real-IP  $remote_addr;
#    proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;
#    proxy_set_header Host $http_host;
#    proxy_set_header X-Forwarded-Proto https;
#    proxy_redirect off;
#    proxy_pass http://neocompiler.io:10332/;
#   }
# } #rpc python

#location /socket {
# proxy_http_version 1.1;
# proxy_set_header Upgrade $http_upgrade;
# proxy_set_header Connection "upgrade";
# proxy_read_timeout 86400;
# proxy_pass http://neoscan;
#}

}
#==================== END HTTP ====================================
#==================================================================
#==================================================================



#daemon off;
